---
title: "Intervalos de Confianza"
author: "Paul Efren Santos Andrade"
date: 2018-08-23
categories: ["R"]
tags: ["R Markdown", "plot"]
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE)
```


Supongamos que estamos buscando conocer cual es el promedio de la densidad de madera de todas las especies arboreas conocidas para la ciencia. Para este ejemplo generaremos datos referentes a la dencidad de madera para las especies arboreas tomaremos informacion de los trabajos de Zanne, A.E et,al. 2009 y Beech, E. et,al. 2017.


```{r }
set.seed(2017-12-17)
#Numero de especies arboreas conocidas  aprox. 60 000. Beech, E. #et,al. 2017.
#Promedio y desviaci?n estandar de la densidad de madera, 0.6134 y #0.1759 respectivamente. Zanne, A.E et,al. 2009
poblacion <- rnorm(60000,0.6134,0.1759)
```

Lo que estamos buscando es estimar el promedio de la densidad de madera  , para este ejemplo es "0.6130953".

Normalmente nosotros no podemos medir todos los elementos de una poblaci?n, por lo cual recurrimos a muestras de esta. 

Tomamemos como referencia ua muestra de 100 especies.

```{r}
primera_muestra <- sample(poblacion, 100)
```

Ahora con esta muestra podemos construir el **intervalo_de_confianza** con un 95% de confianza para el promedio de la densidad de madera:

```{r}
# limite inferior "li"

li <- mean(primera_muestra) - 1.96 * (sd(primera_muestra)/sqrt(length(primera_muestra)))
(li)
```


```{r}

# limite superior "ls"
 
ls <- mean(primera_muestra) + 1.96 * (sd(primera_muestra)/sqrt(length(primera_muestra)))
(ls)
```

Como podemos interpretar un intervalo de confianza?
Si tomamos varias muestras de nuestra poblaci?n, el valor real del promedio de esta deberia ser contenido por el intervalo de confiaza de cada una de las muestras. 

Supongamos que hasta el momento se han generado 1000 estudios enfocados en la evaluacion de la densidad de madera: 

```{r}
#Cada columna en la matris *estudios* alberga la informacio #generada por cada uno de los estudios.

estudios<- replicate(1000, sample(poblacion, 100))

limite_inferior<- apply(estudios, 2, function(row){
  mean(row) - 1.96 * (sd(row)/sqrt(length(row)))
})

limite_superior <- apply(estudios, 2, function(row){
  mean(row) + 1.96 * (sd(row)/sqrt(length(row)))
})

promedio_real <- mean(poblacion)
promedio_real
```

Revisemos algunos datos:
  Cuantos intervalos de confianza contienen el valor real del
  promedio de la densidad de madera?.

```{r}
mean(promedio_real > limite_inferior & promedio_real< limite_superior)*100
```

En el 95.1 % de los 1000 estudios los intervalos de confianza contienen el promedio de la densidad de madera.


Visualizemos graficamente estos nuestros resultados:
  
```{r}
# Concideremos unicamente los resultados de los primeros cien 
# estudios generados.

par(mar=c(2,2,0,0)+.5, mgp=c(1.6,.4,0), tcl=-.2, 
    las=1, cex.axis=.9) 

plot(0, 0, xlim = c(1, 100), ylim = c(min(limite_inferior), max(limite_superior)),
     xlab = "Numero de estudios", ylab = "Intervalo de Confianza", bty = "n",
     col = "white",axes = FALSE)
rect(par("usr")[1], par("usr")[3], par("usr")[2], 
     par("usr")[4], col=gray(.9,.9), border='white')
grid(lty=1, col='white')
for(i in 1:100){
  segments(i, limite_inferior[i], i, limite_superior[i], lwd = 2,col="blue")
}
abline(h = promedio_real, col = 1, lwd = 2,lty=2)
legend(70, .55, legend = "Promedio real", col = 1, lty = 1, bty = "n")
axis(1,lwd=2,las=1)
axis(2,las=2,lwd=2)

```


# Referencias:

Basado en **A Short Intro to Confidence Intervals** por [Sean Kross](http://seankross.com/).

Zanne, A.E., Lopez-Gonzalez, G., Coomes, D.A., Ilic, J., Jansen, S., Lewis, S.L., Miller, R.B., Swenson, N.G., Wiemann, M.C., and Chave, J. 2009. [**Global wood density database. Dryad. Identifier**](http://hdl.handle.net/10255/dryad.235). 

E. Beech, M. Rivers, S. Oldfield & P.P. Smith (2017): [**GlobalTreeSearch: The first complete global database of tree species and country distributions.**](https://www.researchgate.net/publication/315596971_GlobalTreeSearch_The_first_complete_global_database_of_tree_species_and_country_distributions)
